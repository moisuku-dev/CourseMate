CREATE TABLE IF NOT EXISTS TOUR_SPOT (
    SPOT_ID VARCHAR(50) NOT NULL PRIMARY KEY COMMENT '관광지 고유 ID',
    NAME VARCHAR(100) NOT NULL COMMENT '관광지명',
    ADDRESS VARCHAR(255) NOT NULL COMMENT '상세 주소',
    CATEGORY VARCHAR(50) COMMENT '분류 (식당, 카페, 명소 등)',
    AVG_RATING DECIMAL(2, 1) DEFAULT 0.0 COMMENT '평균 별점 (0.0 ~ 5.0)',
    REVIEW_COUNT INT DEFAULT 0 COMMENT '리뷰 개수',
    LATITUDE DECIMAL(10, 7) COMMENT '위도',
    LONGITUDE DECIMAL(10, 7) COMMENT '경도',
    IMG_URL VARCHAR(255) COMMENT '대표 이미지 URL'
) DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;



-- 1. 리뷰 테이블 (BLOG_URL 컬럼 추가됨)
CREATE TABLE IF NOT EXISTS REVIEW (
    REVIEW_ID INT AUTO_INCREMENT PRIMARY KEY COMMENT '리뷰 고유 ID',
    USER_ID VARCHAR(50) NOT NULL COMMENT '작성 사용자 ID',
    SPOT_ID VARCHAR(50) NOT NULL COMMENT '관광지 ID',
    RATING DECIMAL(2, 1) NOT NULL DEFAULT 5.0 COMMENT '별점 (1.0 ~ 5.0)',
    CONTENT TEXT NOT NULL COMMENT '리뷰 내용',
    SENTIMENT CHAR(1) DEFAULT 'N' COMMENT 'AI 분석 감성 (P:긍정, N:부정)',
    BLOG_URL VARCHAR(255) COMMENT '참고한 블로그 링크 (요구사항 반영)',
    REG_DATE DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '등록일시'
);

-- 2. 사진 테이블
CREATE TABLE IF NOT EXISTS PHOTO (
    PHOTO_ID INT AUTO_INCREMENT PRIMARY KEY COMMENT '사진 고유 ID',
    SPOT_ID VARCHAR(50) NOT NULL COMMENT '관광지 ID',
    IMG_URL VARCHAR(255) NOT NULL COMMENT '이미지 URL',
    USER_ID VARCHAR(50) COMMENT '등록한 사용자 ID (관리자면 NULL 가능)',
    REG_DATE DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '등록일시'
);


-- 1. 태그 테이블 (태그 정보 저장)
CREATE TABLE IF NOT EXISTS TAG (
    TAG_ID INT AUTO_INCREMENT PRIMARY KEY COMMENT '태그 고유 ID',
    TAG_NAME VARCHAR(50) NOT NULL UNIQUE COMMENT '태그명 (예: #뷰맛집)'
);

-- 2. 관광지-태그 매핑 테이블 (어떤 관광지에 어떤 태그가 있는지)
CREATE TABLE IF NOT EXISTS SPOT_FEATURE (
    FEATURE_ID INT AUTO_INCREMENT PRIMARY KEY,
    SPOT_ID VARCHAR(50) NOT NULL COMMENT '관광지 ID',
    TAG_ID INT NOT NULL COMMENT '태그 ID',
    SCORE DECIMAL(4, 3) DEFAULT 0.0 COMMENT '태그 관련성 점수',
    FOREIGN KEY (SPOT_ID) REFERENCES TOUR_SPOT(SPOT_ID) ON DELETE CASCADE,
    FOREIGN KEY (TAG_ID) REFERENCES TAG(TAG_ID) ON DELETE CASCADE,
    UNIQUE KEY unique_spot_tag (SPOT_ID, TAG_ID) -- 중복 방지
);

-- 1. 사용자 테이블에 권한(ROLE) 컬럼 추가 (기존 USER 테이블 수정)
-- 이미 데이터가 있다면 'USER'로 초기화됩니다. 관리자는 'ADMIN'으로 직접 업데이트 필요.
ALTER TABLE USER ADD COLUMN IF NOT EXISTS ROLE VARCHAR(10) DEFAULT 'USER' COMMENT '권한(USER, ADMIN)';

-- 2. 공지사항 테이블 (관리자만 작성 가능)
CREATE TABLE IF NOT EXISTS NOTICE (
    NOTICE_ID INT AUTO_INCREMENT PRIMARY KEY,
    USER_ID VARCHAR(50) NOT NULL COMMENT '작성자(관리자) ID',
    TITLE VARCHAR(100) NOT NULL,
    CONTENT TEXT NOT NULL,
    REG_DATE DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 3. 커뮤니티 의견 테이블 (자유 게시판)
CREATE TABLE IF NOT EXISTS COMMUNITY (
    POST_ID INT AUTO_INCREMENT PRIMARY KEY,
    USER_ID VARCHAR(50) NOT NULL COMMENT '작성자 ID',
    TITLE VARCHAR(100) NOT NULL,
    CONTENT TEXT NOT NULL,
    REG_DATE DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (USER_ID) REFERENCES USER(USER_ID) ON DELETE CASCADE
);